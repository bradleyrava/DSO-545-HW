---
title: 'DSO 545: HW 1'
author: "Bradley Rava, Patrick Vossler, Simeng Shao"
date: "1/27/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)

```

Load the data:
```{r}
baggage = read.csv(here("HW1", "Baggage.csv"), header=T, stringsAsFactors = F)
indus_med = read.csv(here("HW1","IndustryMedians.csv"),header=T)
head(baggage)
```

Process data:
```{r}
baggage$Date = as.Date(paste0("02/",baggage$Date),"%d/%m/%Y")
baggage$Month = factor(baggage$Month,labels=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))
baggage$Airline = as.character(baggage$Airline)
```

## 1. Explore baggage complaints over time: create 3 time series plots for the variable *Baggage* by Date for each of the airlines separately.
```{r}
airlines = unique(baggage$Airline)
for(i in 1:length(airlines)){
    airline = airlines[i]
    data = baggage[baggage$Airline == airline,]
    res = aggregate(data["Baggage"], by=list(Month = data$Month), sum)
    plot(x=as.integer(res$Month),y=res$Baggage,type="o",xaxt="n",xlab="Month", ylab="Number of Baggage Complaints")
    axis(1,at = seq(1,12),labels = levels(res$Month))
    title(paste(airline,"Baggage Complaints (2004-2010)"))
    
}
```

## 2. Briefly describe what patterns you see in the plots
In some of the plots we see a cyclical pattern with the number of baggage complaints increasing during the winter holiday travel season (November-January). There is often another spike in baggage complaints in the summer likely when families are going on summer vacations.

* American Eagle
    * We see that the cyclical yearly trend described above holds for American Eagle. Furthermore we see that there is an increase in the total number of complaints in 2006-2008 and then the number of complaints drops back down from 2009 onward.
* Hawaiian Airlines
    * Compared to American Eagle, Hawaiian Airlines has a smaller number of complaints each month. This is expected because Hawaiian Airlines is a smaller airline compared to American Eagle. Whereas American Eagle had a spike in baggage complaints during the winter holiday travel season, Hawaiian Airlines seems to have spikes in baggage complaints during the Spring and Summer. This perhaps could be because they see an influx of passengers wishing to travel to Hawaii during the Spring and Summer months.
    * The most concerning trend for Hawaiian Airlines is the trend of larger spikes in each of the successive years, culminating with a large spike in baggage complaints during the 2010 holiday season.
* United Airlines
    * Unsurprisingly United Airlines has a larger number of baggage complaints overall which can be explained by its much larger size compared to the other two companies.
    * Like American Eagle we see that United Airlines also experiences a surge in baggage claims during the holiday season. Additionally, it is interesting that both American Eagle and United Airlines have a spike in baggage complaints during 2006. Perhaps there was some external event that caused this for both airlines?
    * Since both American Eagle and United Airlines provide a variety of flights to domestic destinations it is not surprising to see that they have similar baggage complaint patterns in the summer and winter months.

## 3.
```{r}
airlines = unique(baggage$Airline)
for(i in 1:length(airlines)){
    airline = airlines[i]
    data = baggage[baggage$Airline == airline,]
    res = aggregate(data["Baggage"], by=list(Month = data$Month, Year = data$Year), sum)
    years = unique(data$Year)
    plot_dat = res[res$Year == years[1],]
    
    #bottom,left,top,right margin
    par(mar=c(7.1, 4.1, 3.1, 8.9), xpd=TRUE)

    plot(x=as.integer(plot_dat$Month),y=plot_dat$Baggage,type="o",xaxt="n",xlab="", ylab="Number of Baggage Complaints",lty=1, col=1, pch = 1,ylim = c(min(res$Baggage),max(res$Baggage)))
    axis(1,at = seq(1,12),labels = levels(res$Month))
    title(paste(airline,"Baggage Complaints"))   
    for(j in 1:length(years)){
        plot_dat = res[res$Year == years[j],]
        lines(x=as.integer(plot_dat$Month),y=plot_dat$Baggage,type="o",lty=j, col=j,pch=j)
        
    }
    legend("topright", inset=c(-0.2,0), legend=years, pch=1:length(years),lty=1:length(years),col=1:length(years), title="Years")
    
    
}
```

## 4. Describe the patterns in the plot

## 5. Plot all three airline Baggage data by Date on one graph.
```{r}
# Maybe do this on the log scale?
airlines = unique(baggage$Airline)
airline = airlines[1]

total_aggregated = aggregate(baggage["Baggage"], by=list(Month = baggage$Month,Airline=baggage$Airline), sum)

data = baggage[baggage$Airline == airline,]
res = aggregate(data["Baggage"], by=list(Month = data$Month), sum)
par(mar=c(7.1, 4.1, 3.1, 8.9), xpd=TRUE)
plot(x=as.integer(res$Month),y=res$Baggage,type="o",xaxt="n",xlab="Month", ylab="Number of Baggage Complaints",lty=1, col=1, pch = 1,ylim= c(0,max(total_aggregated$Baggage)))
axis(1,at = seq(1,12),labels = levels(res$Month))
title("Baggage Complaints for all 3 Airlines (2004-2010)")
for(i in 2:length(airlines)){
    airline = airlines[i]
    data = baggage[baggage$Airline == airline,]
    plot_dat = aggregate(data["Baggage"], by=list(Month = data$Month), sum)
    lines(x=as.integer(plot_dat$Month),y=plot_dat$Baggage,type="o",lty=i, col=i,pch=i)
}
legend("topright", inset=c(-0.375,0), legend=airlines, pch=1:length(airlines),lty=1:length(airlines),col=1:length(airlines), title="Airlines")

```


## Case 2: CEO Compensation

```{r case 2 load data}
x <- read.table(here("HW1", "CEOcompensation.txt"), header = T, sep = "\t", quote = "\"", row.names = 1)
head(x)
```

\textbf{Question 1:} What is the number of female CEO's?

```{r question 1}
num.ceo.f <- length(x$CEO[x$Gender == "F"])
print(paste("The number of female CEO's is", num.ceo.f))
```

\textbf{Question 2:} What is the age of the youngest CEO?

```{r question 2}
age.ceo.min <- min(x$Age)
print(paste("The age of the youngest CEO is", age.ceo.min))
```

\textbf{Question 3:} What is the age of the oldest CEO?

```{r question 3}
age.ceo.max <- max(x$Age)
print(paste("The age of the oldest CEO is", age.ceo.max))
```

\textbf{Question 4:} What is the average age of a CEO?

```{r question 4}
age.ceo.avg <- round(mean(x$Age), 2)
print(paste("The average age of a CEO is", age.ceo.avg))
```

\textbf{Question 5:} What is the total CEO 2008 salary?
```{r question 5}
tot.2008.sal <- sum(x$X2008.Salary)
print(paste("The total CEO 2008 salary is", paste0(tot.2008.sal,"0"), "million"))
```

\textbf{Question 6:} How many CEOs have joined a company as a CEO? (Hint: CEOs can always be founders. Founders can’t always be CEOs)

```{r question 6}
## Here we claim that a CEO joined the company as a CEO if the number of years she was at the company equals the number of years she has been CEO.

yearCheck <- sum(x$Years.as.company.CEO == x$Years.with.company)
print(paste(yearCheck, "CEO's joined a company as a CEO"))
```

\textbf{Question 7:} What is the average amount of time a CEO worked for a company before becoming a CEO? (Use two decimal digit precision)

```{r question 7}
beforeCEO <- round(mean(x$Years.with.company - x$Years.as.company.CEO), 2)
print(paste("The average amount of time a CEO worked for a company before becoming a CEO is", beforeCEO, "years"))
```

\textbf{Question 8:} Which industry in the data set has largest number CEO’s?

```{r question 8}
numCEO <- aggregate(x$CEO, list(Industry = x$Industry), FUN = length)
industry.max.ceo <- numCEO[[1]][which(numCEO[[2]] == max(numCEO[[2]]))]
print(paste("The industry with the largest number of CEO's is", industry.max.ceo))
```

\textbf{Question 9:} What is the average CEO 2008 Compensation? Note that 2008 compensation for a CEO consists of a total four components: Salary, Bonus, other (including vested restricted stock grants, LTIP (long-term incentive plan) payouts, and perks), and stock gains. (Use two decimal digit precision)

```{r question 9}
totCompensation <- round(mean(x$X2008.Salary + x$X2008.Bonus + x$X2008.Other + x$X2008.Stock.gains), 2)
print(paste("The average CEO 2008 Compensation is", totCompensation, "million"))
```

\textbf{Question 10:} Which CEO did get paid the largest compensation amount in 2008?

```{r question 10:}
ceoCompensation <- x$X2008.Salary + x$X2008.Bonus + x$X2008.Other + x$X2008.Stock.gains
maxCompensation <- which(ceoCompensation == max(ceoCompensation))
print(paste("The CEO with the largest compensation amount in 2008 is", x$CEO[maxCompensation]))
```

\textbf{Question 11:} What is the corresponding amount? (Use two decimal digit precision)

```{r question 11:}
ceoCompensation <- x$X2008.Salary + x$X2008.Bonus + x$X2008.Other + x$X2008.Stock.gains
print(paste("The corresponding amount is", max(ceoCompensation), "million"))
```

\textbf{Question 12:} Which industry does correspond to the second largest total CEO compensation in 2008? (Hint:check sort(), order () functions).

```{r question 12}
ceoCompensation <- x$X2008.Salary + x$X2008.Bonus + x$X2008.Other + x$X2008.Stock.gains
secondMaxCompensation <- which(ceoCompensation == tail(sort(ceoCompensation), 2)[1])
print(paste("The industry with the second largest total CEO compensation is", x$Industry[secondMaxCompensation]))
```

\textbf{Question 13:} Consider the following age groups: [45 – 50), [50 – 55), [55 – 60), [60 – 70), and [70 or more). Analyze age groups by industry and determine which age group corresponds to largest CEO average salary in 2008? Hint: 1. left end point is included; 2. nested if helps assign age category

```{r question 13}
ageGroups <- vector(mode="numeric", length=nrow(x))
ageGroups[which(x$Age >= 45 & x$Age < 50)] <- 1
ageGroups[which(x$Age >= 50 & x$Age < 55)] <- 2
ageGroups[which(x$Age >= 55 & x$Age < 60)] <- 3
ageGroups[which(x$Age >= 60 & x$Age < 70)] <- 4
ageGroups[which(x$Age >= 70)] <- 5
x$ageGroups <- ageGroups

groupByIndustry <- aggregate(x$X2008.Salary, list(ageGroups = x$ageGroups, 
                               industry = x$Industry), mean)
groupByAge <- as.matrix(aggregate(x$X2008.Salary, list(ageGroups = x$ageGroups), mean))

print(paste("The age group that has the highest average salary is group", groupByAge$ageGroups[which(groupByAge$x == max(groupByAge$x))],"which corresponds to [70 or more)"))

print(paste("This corresponded to the industry of", groupByIndustry$industry[which(groupByIndustry$x == max(groupByIndustry$x))], "where the salary was", max(groupByIndustry$x), "million"))

## Import median data
y <- read.csv("IndustryMedians.csv")

## Calculate percent difference for each CEO
z <- cbind.data.frame(ceoCompensation, industry=x$Industry)
  
x$percentDiff <- sapply(1:nrow(z), function(i) {
  compensation <- z$ceoCompensation[i]
  indMed <- y$Total.compensation[which(y$Industry == z$industry[i])]
  return( (compensation - indMed) / indMed*100)
})

## Look at the percent difference for each CEO
print(x$percentDiff)
hist(x$percentDiff, main = "Percent Difference for each CEO", xlab = "Percent Difference")
```

\textbf{Question 14:} How many CEO’s have received 100% or larger compensation relative to their respective median compensation?

```{r question 14}
numLarger <- length(which(x$percentDiff > 100))
print(paste("The number of CEO's that recieved 100% or larger compensation relative to their respective median compensation is", numLarger))
```

\textbf{Question 15:} Is the following formula always true? 

```{r question 15}
y$totalMedianCompensation <- y$Salary + y$Bonus + y$Other + y$Stock.Gains

print(paste("There are a total of", length(which(y$totalMedianCompensation != y$Total.compensation)), "where the total median compensation formula does not match our given total median compensation. This means the formula is not always true."))
```
